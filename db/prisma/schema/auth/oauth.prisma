enum ProviderOAuthSetupStatus {
  unused
  opened
  completed
  failed
  expired
}

model ProviderOAuthSetup {
  oid    BigInt                   @id
  id     String                   @unique
  status ProviderOAuthSetupStatus @default(unused)

  clientSecret String

  isParentDeleted Boolean @default(false)

  isEphemeral Boolean

  name        String?
  description String?
  metadata    Json?

  redirectUrl String?
  backendUrl  String

  errorCode    String?
  errorMessage String?

  authCredentialsOid BigInt
  authCredentials    ProviderAuthCredentials @relation(fields: [authCredentialsOid], references: [oid])

  authMethodOid BigInt
  authMethod    ProviderAuthMethod @relation(fields: [authMethodOid], references: [oid])

  tenantOid BigInt
  tenant    Tenant @relation(fields: [tenantOid], references: [oid], onDelete: Cascade)

  solutionOid BigInt
  solution    Solution @relation(fields: [solutionOid], references: [oid], onDelete: Cascade)

  providerOid BigInt
  provider    Provider @relation(fields: [providerOid], references: [oid], onDelete: Cascade)

  deploymentOid BigInt?
  deployment    ProviderDeployment? @relation(fields: [deploymentOid], references: [oid])

  authConfigOid BigInt?
  authConfig    ProviderAuthConfig? @relation(fields: [authConfigOid], references: [oid])

  slateOAuthSetupOid BigInt?          @unique
  slateOAuthSetup    SlateOAuthSetup? @relation(fields: [slateOAuthSetupOid], references: [oid], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  expiresAt DateTime

  providerSetupSession       ProviderSetupSession?
  providerSetupSessionEvents ProviderSetupSessionEvent[]

  @@index([status])
  @@index([expiresAt])
}
