enum SessionStatus {
  active
  inactive
  deleted
}

model Session {
  oid BigInt @id
  id  String @unique

  status SessionStatus

  connectionState SessionConnectionState @default(disconnected)
  isStarted       Boolean                @default(false)

  name        String?
  description String?
  metadata    Json?

  sharedProviderName        String?
  sharedProviderDescription String?

  tenantOid BigInt
  tenant    Tenant @relation(fields: [tenantOid], references: [oid])

  solutionOid Int
  solution    Solution @relation(fields: [solutionOid], references: [oid], onDelete: Cascade)

  totalProductiveClientMessageCount Int @default(0)
  totalProductiveServerMessageCount Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  lastConnectionCreatedAt DateTime?
  lastMessageAt           DateTime?
  lastActiveAt            DateTime?

  providers       SessionProvider[]
  providerRuns    ProviderRun[]
  sessionMessages SessionMessage[]
  sessionEvents   SessionEvent[]
  connections     SessionConnection[]
  sessionErrors   SessionError[]

  @@index([lastActiveAt])
  @@index([connectionState])
  @@index([status])
}
