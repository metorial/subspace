model ProviderRun {
  oid BigInt @id
  id  String @unique

  providerOid BigInt
  provider    Provider @relation(fields: [providerOid], references: [oid])

  providerVersionOid BigInt
  providerVersion    ProviderVersion @relation(fields: [providerVersionOid], references: [oid])

  sessionOid BigInt
  session    Session @relation(fields: [sessionOid], references: [oid])

  instanceOid BigInt
  instance    SessionProviderInstance @relation(fields: [instanceOid], references: [oid])

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  sessionMessages SessionMessage[]
}

model SessionProviderInstance {
  oid BigInt @id
  id  String @unique

  totalProductiveClientMessageCount Int @default(0)
  totalProductiveServerMessageCount Int @default(0)

  sessionProviderOid BigInt
  sessionProvider    SessionProvider @relation(fields: [sessionProviderOid], references: [oid])

  pairOid BigInt
  pair    ProviderDeploymentConfigPair @relation(fields: [pairOid], references: [oid])

  pairVersionOid BigInt
  pairVersion    ProviderDeploymentConfigPairProviderVersion @relation(fields: [pairVersionOid], references: [oid])

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  lastRenewedAt DateTime?
  lastUsedAt    DateTime?
  expiresAt     DateTime

  providerRuns ProviderRun[]

  @@index([expiresAt])
}
